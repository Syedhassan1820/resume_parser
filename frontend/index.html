<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sparc Technologies – Resume Parser</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
</head>
<body class="bg-light">
<div class="container py-4">
  <h2 class="mb-4">Sparc Technologies – Resume Parser</h2>

  <!-- Upload form -->
  <form id="uploadForm" class="mb-4">
    <div class="mb-3">
      <label for="resumeFile" class="form-label">Upload Resume (PDF/DOCX)</label>
      <input type="file" id="resumeFile" name="file" class="form-control" required />
    </div>
    <button type="submit" class="btn btn-primary">Upload & Extract</button>
  </form>

  <div id="loading" class="alert alert-info d-none">Processing resume…</div>
  <div id="error" class="alert alert-danger d-none"></div>

  <!-- Result section -->
  <div id="result" class="d-none">
    <h4>Extracted Details</h4>
    <table class="table table-bordered">
      <tbody id="detailsTableBody"></tbody>
    </table>

    <h5>Skills</h5>
    <ul id="skillsList" class="list-group mb-3"></ul>

    <h5>Education</h5>
    <table class="table table-sm table-striped mb-3">
      <thead>
        <tr><th>Degree</th><th>Institute</th><th>Start Year</th><th>End Year</th></tr>
      </thead>
      <tbody id="eduTableBody"></tbody>
    </table>

    <h5>Experience</h5>
    <table class="table table-sm table-striped">
      <thead>
        <tr><th>Job Title</th><th>Company</th><th>From</th><th>To</th><th>Description</th></tr>
      </thead>
      <tbody id="expTableBody"></tbody>
    </table>
  </div>
</div>

<script>
const form = document.getElementById('uploadForm');
const loading = document.getElementById('loading');
const errorDiv = document.getElementById('error');
const resultDiv = document.getElementById('result');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  errorDiv.classList.add('d-none');
  resultDiv.classList.add('d-none');
  loading.classList.remove('d-none');

  const fileInput = document.getElementById('resumeFile');
  if (!fileInput.files.length) {
    loading.classList.add('d-none');
    errorDiv.textContent = 'Please select a file.';
    errorDiv.classList.remove('d-none');
    return;
  }

  const formData = new FormData();
  formData.append('file', fileInput.files[0]);

  try {
    const res = await fetch('http://127.0.0.1:8000/upload_resume', {
      method: 'POST',
      body: formData
    });

    const data = await res.json();
    if (!res.ok) {
      throw new Error(data.detail || 'Server error');
    }

    populateResult(data.parsed);
  } catch (err) {
    errorDiv.textContent = 'Error: ' + err.message;
    errorDiv.classList.remove('d-none');
  } finally {
    loading.classList.add('d-none');
  }
});

function addRow(tbody, label, value) {
  const tr = document.createElement('tr');
  tr.innerHTML = `<th style="width: 25%">${label}</th><td>${value ?? ''}</td>`;
  tbody.appendChild(tr);
}

function populateResult(parsed) {
  const detailsBody = document.getElementById('detailsTableBody');
  detailsBody.innerHTML = '';
  addRow(detailsBody, 'Full Name', parsed.full_name);
  addRow(detailsBody, 'Email', parsed.email);
  addRow(detailsBody, 'Phone', parsed.phone);
  addRow(detailsBody, 'Total Experience (years)', parsed.total_experience_years);
  addRow(detailsBody, 'Current Role', parsed.current_role);
  addRow(detailsBody, 'Current Company', parsed.current_company);
  addRow(detailsBody, 'Location', parsed.location);

  const skillsList = document.getElementById('skillsList');
  skillsList.innerHTML = '';
  (parsed.skills || []).forEach(skill => {
    const li = document.createElement('li');
    li.className = 'list-group-item';
    li.textContent = skill;
    skillsList.appendChild(li);
  });

  const eduBody = document.getElementById('eduTableBody');
  eduBody.innerHTML = '';
  (parsed.education || []).forEach(e => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${e.degree || ''}</td>
      <td>${e.institute || ''}</td>
      <td>${e.start_year || ''}</td>
      <td>${e.end_year || ''}</td>
    `;
    eduBody.appendChild(tr);
  });

  const expBody = document.getElementById('expTableBody');
  expBody.innerHTML = '';
  (parsed.experience || []).forEach(x => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${x.job_title || ''}</td>
      <td>${x.company || ''}</td>
      <td>${x.start_date || ''}</td>
      <td>${x.end_date || ''}</td>
      <td>${x.description || ''}</td>
    `;
    expBody.appendChild(tr);
  });

  resultDiv.classList.remove('d-none');
}
</script>
</body>
</html>
